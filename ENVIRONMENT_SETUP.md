# Environment Setup Guide

This guide explains how to set up environment variables for the Patient Management System (PMS) using `python-decouple`.

## Overview

The project now uses `python-decouple` for environment variable management, which provides:
- Type casting for environment variables
- Default values
- CSV parsing for lists
- Better error handling
- Separation of configuration from code

## Installation

1. **Install python-decouple**:
   ```bash
   pip install python-decouple
   ```

2. **Or install all requirements**:
   ```bash
   pip install -r requirement.txt
   ```

## Environment Setup

### Method 1: Using the Management Command (Recommended)

Run the built-in management command to create your `.env` file:

```bash
python manage.py setup_env
```

This will:
- Generate secure secret keys
- Create a `.env` file with all necessary variables
- Set up default values for development
- Create the logs directory

### Method 2: Manual Setup

1. **Copy the example file**:
   ```bash
   cp env.example .env
   ```

2. **Edit the `.env` file** with your actual values:
   ```bash
   nano .env
   ```

## Environment Variables

### Required Variables

```env
# Django Settings
SECRET_KEY=your-super-secret-key-here
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1

# Database Configuration
DATABASE_ENGINE=django.db.backends.postgresql
DATABASE_NAME=pms_db
DATABASE_USER=postgres
DATABASE_PASSWORD=your-database-password
DATABASE_HOST=localhost
DATABASE_PORT=5432
```

### Optional Variables (with defaults)

```env
# JWT Settings
JWT_SECRET_KEY=your-jwt-secret-key
JWT_ACCESS_TOKEN_LIFETIME=15  # minutes
JWT_REFRESH_TOKEN_LIFETIME=7  # days

# Email Configuration
EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password

# OTP Configuration
OTP_CODE_LENGTH=6
OTP_TTL_SECONDS=300
OTP_MAX_ATTEMPTS=5

# Google Cloud Storage
GCS_BUCKET_NAME=your-bucket-name
GCS_UPLOAD_PREFIX=uploads/
GCS_CREDENTIALS_PATH=path/to/credentials.json

# API Settings
API_PAGE_SIZE=20
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
```

## Environment-Specific Settings

The project now supports multiple environments through separate settings files:

### Development
```bash
python manage.py runserver --settings=pms_backend.settings.development
```

### Production
```bash
python manage.py runserver --settings=pms_backend.settings.production
```

### Testing
```bash
python manage.py test --settings=pms_backend.settings.testing
```

## Environment Variable Types

`python-decouple` supports automatic type casting:

```python
# Boolean
DEBUG = config('DEBUG', default=True, cast=bool)

# Integer
API_PAGE_SIZE = config('API_PAGE_SIZE', default=20, cast=int)

# CSV (comma-separated values)
ALLOWED_HOSTS = config('ALLOWED_HOSTS', default='localhost,127.0.0.1', cast=Csv())
```

## Database Configuration

### SQLite (Development)
```env
DATABASE_ENGINE=django.db.backends.sqlite3
DATABASE_NAME=db.sqlite3
```

### PostgreSQL (Production)
```env
DATABASE_ENGINE=django.db.backends.postgresql
DATABASE_NAME=pms_db
DATABASE_USER=postgres
DATABASE_PASSWORD=secure-password
DATABASE_HOST=localhost
DATABASE_PORT=5432
```

## Email Configuration

### Console Backend (Development)
```env
EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend
```

### SMTP Backend (Production)
```env
EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password
```

## Google Cloud Storage

1. **Create a GCS bucket**
2. **Download service account credentials**
3. **Set the path to credentials**:
   ```env
   GCS_CREDENTIALS_PATH=/path/to/your/credentials.json
   GCS_BUCKET_NAME=your-bucket-name
   ```

## Security Best Practices

### Development
- Use strong secret keys (auto-generated by management command)
- Set `DEBUG=True` only in development
- Use console email backend
- Allow all hosts for testing

### Production
- Use environment variables for all sensitive data
- Set `DEBUG=False`
- Use strong passwords and secret keys
- Configure proper CORS origins
- Enable SSL/TLS
- Use secure cookie settings

## Docker Integration

For Docker deployments, you can use environment variables directly:

```dockerfile
# Dockerfile
ENV SECRET_KEY=your-secret-key
ENV DEBUG=False
ENV DATABASE_ENGINE=django.db.backends.postgresql
```

Or use a `.env` file with docker-compose:

```yaml
# docker-compose.yml
services:
  web:
    env_file:
      - .env
```

## Troubleshooting

### Common Issues

1. **ModuleNotFoundError: No module named 'decouple'**
   ```bash
   pip install python-decouple
   ```

2. **Environment variable not found**
   - Check if the variable exists in your `.env` file
   - Verify the variable name (case-sensitive)
   - Check if you have a default value set

3. **Type casting errors**
   - Ensure the value can be cast to the specified type
   - Check for extra spaces or characters

### Debug Environment Variables

You can check which environment variables are being loaded:

```python
# In Django shell
from decouple import config
print(f"DEBUG: {config('DEBUG', default=False, cast=bool)}")
print(f"SECRET_KEY: {config('SECRET_KEY', default='not-set')}")
```

## Migration from os.getenv()

The project has been migrated from `os.getenv()` to `python-decouple`. Key differences:

### Before (os.getenv)
```python
DEBUG = os.getenv('DEBUG', 'False').lower() in ['true', '1']
DATABASE_HOST = os.getenv('DATABASE_HOST', 'localhost')
```

### After (python-decouple)
```python
DEBUG = config('DEBUG', default=False, cast=bool)
DATABASE_HOST = config('DATABASE_HOST', default='localhost')
```

## File Structure

```
pms_project/
├── .env                    # Environment variables (DO NOT COMMIT)
├── env.example            # Example environment file
├── pms_backend/
│   └── settings/
│       ├── __init__.py
│       ├── base.py        # Base settings
│       ├── development.py # Development settings
│       ├── production.py  # Production settings
│       └── testing.py     # Testing settings
└── requirement.txt
```

## Next Steps

1. Run the setup command: `python manage.py setup_env`
2. Update the `.env` file with your actual values
3. Run migrations: `python manage.py migrate`
4. Create a superuser: `python manage.py createsuperuser`
5. Start the server: `python manage.py runserver`

## Security Note

⚠️ **IMPORTANT**: Never commit your `.env` file to version control. Add it to your `.gitignore` file:

```gitignore
# Environment variables
.env
.env.local
.env.production
```
